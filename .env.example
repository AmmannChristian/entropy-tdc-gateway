# ========================================
# Runtime
# ========================================
ENVIRONMENT=prod

# ========================================
# TLS Configuration (shared across all components)
# ========================================
# Server certificate and key (for incoming connections to Entropy/Metrics endpoints)
TLS_CERT_FILE=/certs/tls.crt
TLS_KEY_FILE=/certs/tls.key

# CA certificate (for verifying client certificates in mTLS and server certificates in outgoing connections)
TLS_CA_FILE=/certs/ca.crt

# ========================================
# MQTT Configuration
# ========================================
MQTT_BROKER_URL=tcp://192.168.0.31:1883
MQTT_CLIENT_ID=
MQTT_TOPICS=timestamps/channel/1,timestamps/channel/2
MQTT_QOS=0

# ========================================
# Prometheus Metrics
# ========================================
METRICS_BIND=10.10.0.2:8080
PROM_METRICS_ENABLED=true
METRICS_TLS_ENABLED=true
METRICS_TLS_CLIENT_AUTH=none

# Override TLS files for metrics if needed (optional, uses shared TLS_* by default)
# METRICS_TLS_CERT_FILE=
# METRICS_TLS_KEY_FILE=
# METRICS_TLS_CA_FILE=

# ========================================
# Batch Collector Configuration
# ========================================
COLLECTOR_BATCH_SIZE=1840

# ========================================
# Entropy Pool & HTTP Endpoint
# ========================================
ENTROPY_POOL_MIN_BYTES=512
ENTROPY_POOL_MAX_BYTES=16384
ENTROPY_READY_MIN_BYTES=1024
ENTROPY_HTTP_ADDR=127.0.0.1:9797
ENTROPY_RETRY_AFTER_SEC=1
ALLOW_PUBLIC_HTTP=false

# TLS Configuration
ENTROPY_TLS_ENABLED=true
ENTROPY_TLS_CLIENT_AUTH=require

# Override TLS files for entropy endpoint if needed (optional, uses shared TLS_* by default)
# ENTROPY_TLS_CERT_FILE=
# ENTROPY_TLS_KEY_FILE=
# ENTROPY_TLS_CA_FILE=

# Rate Limiting (Token Bucket Algorithm)
ENTROPY_RATE_LIMIT_RPS=25
ENTROPY_RATE_LIMIT_BURST=25

# ========================================
# Cloud Forwarder (gRPC Client)
# ========================================
CLOUD_FORWARDER_ENABLED=false
CLOUD_FORWARDER_SERVER_ADDR=cloud.example.com:9090

# TLS Configuration (for secure connection to cloud server)
CLOUD_FORWARDER_TLS_ENABLED=true
CLOUD_FORWARDER_TLS_SERVER_NAME=cloud.example.com

# Override TLS files for cloud forwarder if needed (optional, uses shared TLS_* by default)
# CLOUD_FORWARDER_TLS_CA_FILE=
# CLOUD_FORWARDER_TLS_CERT_FILE=
# CLOUD_FORWARDER_TLS_KEY_FILE=

# Connection & Reconnect Settings
CLOUD_FORWARDER_CONNECT_TIMEOUT=10
CLOUD_FORWARDER_RECONNECT_DELAY=5
CLOUD_FORWARDER_MAX_RECONNECT=60
# Rotate the gRPC stream to refresh OAuth2 tokens (e.g., 55m, 3600s, 600000ms). 0 disables.
CLOUD_FORWARDER_STREAM_ROTATE_INTERVAL=0s

# OAuth2 / OIDC Configuration (e.g., Zitadel)
CLOUD_FORWARDER_OAUTH2_ENABLED=false
CLOUD_FORWARDER_OAUTH2_TOKEN_URL=https://zitadel.example.com/oauth/v2/token
CLOUD_FORWARDER_OAUTH2_CLIENT_ID=your-client-id
CLOUD_FORWARDER_OAUTH2_CLIENT_SECRET=your-client-secret
# Alternative: Use file for secret (more secure)
# CLOUD_FORWARDER_OAUTH2_CLIENT_SECRET_FILE=/run/secrets/oauth2_client_secret
CLOUD_FORWARDER_OAUTH2_SCOPES=openid profile email
